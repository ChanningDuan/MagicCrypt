<?php class MagicCrypt{private $iv;private $key;private $bit;function MagicCrypt($key,$bit=128,$iv=""){if($bit==256){$this->key=hash('SHA256',$key,true);}else{$this->key=hash('MD5',$key,true);}if($iv!=""){$this->iv=hash('MD5',$iv,true);}else{$this->iv=chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0).chr(0);}}function encrypt($str){$module=mcrypt_module_open(MCRYPT_RIJNDAEL_128,'',MCRYPT_MODE_CBC,'');mcrypt_generic_init($module,$this->key,$this->iv);$block=mcrypt_get_block_size(MCRYPT_RIJNDAEL_128,MCRYPT_MODE_CBC);$pad=$block -(strlen($str)% $block);$str.=str_repeat(chr($pad),$pad);$encrypted=mcrypt_generic($module,$str);mcrypt_generic_deinit($module);mcrypt_module_close($module);return base64_encode($encrypted);}function decrypt($str){$module=mcrypt_module_open(MCRYPT_RIJNDAEL_128,'',MCRYPT_MODE_CBC,'');mcrypt_generic_init($module,$this->key,$this->iv);$str=mdecrypt_generic($module,base64_decode($str));mcrypt_generic_deinit($module);mcrypt_module_close($module);$slast=ord(substr($str,-1));$str=substr($str,0,strlen($str)- $slast);return $str;}}?>
